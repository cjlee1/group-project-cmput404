{% extends 'base.html' %}

{% block title %}{{author.username}}'s profile{% endblock %}

{% block content %}
{% if user.is_authenticated %}
{% load static %}

<link rel="stylesheet" type="text/css" href="{% static 'homepage/homepage.css' %}">
<h1 id="greeting">{{ user.displayname }}'s Profile.</h1>
<br>
<h2>Posts</h2>
{% for p in posts reversed %}
  <div class="row">
    <div class="panel panel-default">
      {% load tz %}
      <div class="puser"><a href="{% url 'profile' username=user.username %}">{{post.author}}</a> 
      <div class="timePub">{{p.published|timezone:"America/Edmonton"}}</div> </div>
      {% if user.id == p.author_id %}
      <p class="delete_post">
          <a href="{% url 'delete_post' pk=p.pk  %}"><span class="glyphicon glyphicon-trash"> </a>
      </p>
      {% endif %}
      <div class="panel-body">
          <p class="ptitle">{{p.title}} </p>
          <p class="pbody">{{p.body|safe}}</p>
          {% if p.image_link != "" %}
          {% load static %}
          <!--CSS should ensure images fit within a certain size
              Atleast when they are being displayed on the homepage -->
          <img class= "pimage" src="{% get_media_prefix %}{{ p.image_link }}">
          {% endif %}

          <div class="comment"><a href="{% url 'comment' pk=p.pk %}">leave a comment </a></div>
        
          {% for comment in p.comments.all %}
          <hr>
          <p class="commentUser"><a href="{% url 'profile' username=comment.author %}">{{comment.author}}</a> </p>
          <p class ="commentDate">{{comment.datetime}} </p>
          <p class="commentBody">{{comment.body}} </p>
          
          {% empty %}
          <hr><br><p class="nocomments">There are currently no comments.</p><br>
          {% endfor %}
          
      </div>
    </div>
  </div>
{% endfor %}

{% else %}
{% load static %}
<link rel="stylesheet" type="text/css" href="{% static 'login/login.css' %}">
<p>You are not logged in</p>
<p><a href="{% url 'signup' %}">Sign Up</a></p>
<p><a href="{% url 'login' %}">Log In </a></p>
{% endif %}
{% endblock %}